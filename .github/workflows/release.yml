name: Build Executable

on: push

jobs:
  build_ubuntu:
    name: Build Sage for Debian
    runs-on: ubuntu-latest
    container: ubuntu:14.04 # GLIBC 2.19
    steps:
    - name: Install dependencies
      run: |
        sudo apt-get update && sudo apt-get upgrade -y
        sudo apt-get install -y curl build-essential

    - uses: actions/checkout@v2
    - uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
    - uses: actions-rs/cargo@v1
      with:
        command: build
        args: --release

    - name: See what's there
      run: |
        ls -alh target/release

  build_windows:
    name: Build Sage for Windows
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
    - uses: actions-rs/cargo@v1
      with:
        command: build
        args: --release

    - name: See what's there
      shell: bash
      run: |
        ls -alh target/release

  build_macos:
    name: Build Sage for MacOS
    strategy:
      matrix:
        target:
          - x86_64-apple-darwin
          - aarch64-apple-darwin

    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
        target: ${{ matrix.target }}
        override: true
    - uses: actions-rs/cargo@v1
      with:
        command: build
        args: --release --target ${{ matrix.target }}

    - name: See what's there
      run: |
        ls -alh target/release
